---
title: "Projeto fantasma"

# Nome do documento PDF gerado
output-file: titulo do projeto
---

```{r}
#| include: false
source("rdocs/source/packages.R")
```

# Define o arquivo principal de dados (com nome exato)
dados <- "relatorio_old_town_road (1).xlsx"

# Corrige o repositório (evita o aviso '404 Not Found')
options(repos = c(CRAN = "https://cran.rstudio.com/"))


# ---------------------------------------------------------------------------- #

#        ______   _____  ________      ________ 
#      |  ____| / ____| |__   __| /\  |__   __|
#     | |__    | (___     | |   /  \    | |   
#    |  __|    \___ \    | |  / /\ \   | |   
#   | |____   ____) |   | |  /____ \  | |   
#  |______   |_____/   |_| /_/    \_\|_|   
#  
#         Consultoria estatística 
#

# ---------------------------------------------------------------------------- #
# ############################## README ###################################### #
# Consultor, favor utilizar este arquivo .R para realizar TODAS as análises
# alocadas a você neste projeto pelo gerente responsável, salvo instrução 
# explícita do gerente para mudança.
#
# Escreva seu código da forma mais clara e legível possível, eliminando códigos
# de teste depreciados, ou ao menos deixando como comentário. Dê preferência
# as funções dos pacotes contidos no Tidyverse para realizar suas análises.
# ---------------------------------------------------------------------------- #
library(tidyverse)
library(lubridate)
library(ggplot2)
library(readxl)

dados <- ("relatorio_old_town_road (1).xlsx")
relatorio <- read_xlsx(dados, sheet = "relatorio_vendas")
vendas <- read_xlsx(dados, sheet = "infos_vendas")
produtos <- read_xlsx(dados, sheet = "infos_produtos")
funcionarios <- read_xlsx(dados, sheet = "infos_funcionarios")
cidades <-  read_xlsx(dados, sheet = "infos_cidades")
clientes <-  read_xlsx(dados, sheet = "infos_clientes")
lojas <-  read_xlsx(dados, sheet = "infos_lojas")

vendas <- vendas %>%
  rename(SaleID = Sal3ID)

lojas <- lojas %>%
  rename(StoreID = Stor3ID )

produtos <- produtos %>%
  rename(ItemID = Ite3ID )

novo_banco <- left_join(produtos, vendas, by= "ItemID")
novo_banco2 <- left_join(relatorio, novo_banco, by= "SaleID")

novo_banco2<- novo_banco2 %>%
  mutate(valor_real= UnityPrice*5.31) 

novo_banco2 <- novo_banco2 %>%
  mutate(ano= year(Date))
view(novo_banco2)

histograma <- ggplot(analise1, aes(x = ano, y = receita_media, group = 1)) +
  geom_line(size = 1, colour = "#A11D21") +
  geom_point(colour = "#A11D21", size = 2) +
  labs(
    x = "Ano",
    y = "Receita média (R$)",
    title = "Receita Média das Lojas (1880–1889)"
  ) +
  theme_classic() +
  scale_x_continuous(breaks = 1880:1889)

ggsave("receita_media_1880_1889_corrigida.pdf",
       plot = histograma,
       width = 158, height = 93, units = "mm")

histograma


# ANÁLISE 2 - Relação entre peso e altura dos clientes

clientela <- clientes %>%
  select(Cli3ntID, Name, Age, Sex, Weight_lbs, Height_dm) %>%
  mutate(
    Peso_kg = Weight_lbs * 0.453592,
    Altura_cm = Height_dm * 10
  )
n_clientes <- nrow(clientela)

resumo_altura_peso <- clientela %>%
  summarise(
    media_peso = mean(Peso_kg, na.rm = TRUE),
    desvio_peso = sd(Peso_kg, na.rm = TRUE),
    media_altura = mean(Altura_cm, na.rm = TRUE),
    desvio_altura = sd(Altura_cm, na.rm = TRUE)
  )

correlacao <- cor(clientela$Peso_kg, clientela$Altura_cm, use = "complete.obs")
correlacao_formatado <- format(round(correlacao, 3), nsmall = 3)
correlacao

dispersao <- clientela %>%
  ggplot(aes(x = Altura_cm, y = Peso_kg)) +
  geom_point(colour = "#A11D21", size = 2.5, alpha = 0.6) +
  labs(
    x = "Altura (cm)",
    y = "Peso (kg)",
    title = "Relação entre Peso e Altura dos Clientes"
  ) +
  theme_classic() +
  theme(
    panel.grid.major = element_line(color = "grey90"),
    panel.grid.minor = element_blank()
  )

ggsave("peso_altura_bivariado.pdf", dispersao, width = 158, height = 93, units = "mm")
view(clientela)



# ANÁLISE 3 - Idade dos clientes de Âmbar Seco a depender da loja (26/10)

cidades <- cidades %>%
  rename(CityID = C1tyID)

clientes <- clientes %>%
  rename(ClientID = Cli3ntID)

banco_completo <- relatorio %>%
  left_join(vendas, by = "SaleID") %>%
  left_join(lojas, by = "StoreID") %>%
  left_join(cidades, by = "CityID") %>%
  left_join(clientes, by = "ClientID")

clientes_ambar <- banco_completo %>%
  filter(tolower(NameCity) == "âmbar seco" | tolower(NameCity) == "ambar seco") %>%
  distinct(ClientID, .keep_all = TRUE) %>%
  filter(!is.na(Age))

box <- ggplot(clientes_ambar) +
  aes(x = reorder(NameStore, Age, FUN = median), y = Age) +
  geom_boxplot(fill = "#A11D21", width = 0.5) +
  stat_summary(
    fun = "mean",
    geom = "point",
    shape = 23,
    size = 3,
    fill = "white"
  ) +
  labs(
    x = "Nome da Loja de Âmbar Seco",
    y = "Idade dos Clientes (anos)",
    title = "Boxplot da Idade dos Clientes por Loja — Âmbar Seco"
  ) +
  theme_estat()  # padrão ESTAT

# Salva o gráfico
ggsave(
  "idade_clientes_ambar_boxplot.pdf",
  plot = box,
  width = 158,
  height = 93,
  units = "mm"
)

print(box)

summary(clientes_ambar$Age)


# ANALISE 4

library(dplyr)
library(ggplot2)

receita_1889 <- novo_banco2 %>%
  filter(ano == 1889) %>%
  group_by(StoreID) %>%
  summarise(receita_total = sum(receita_venda, na.rm = TRUE)) %>%
  arrange(desc(receita_total))

top3_lojas <- receita_1889 %>%
  slice_max(order_by = receita_total, n = 3)

dados_top3_lojas <- novo_banco2 %>%
  filter(ano == 1889, StoreID %in% top3_lojas$StoreID)

ranking_produtos <- dados_top3_lojas %>%
  group_by(StoreID, ItemID, NameProduct) %>%
  summarise(
    quantidade_vendida = sum(Quantity, na.rm = TRUE),
    receita_total = sum(receita_venda, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  arrange(StoreID, desc(receita_total))

top3_produtos_por_loja <- ranking_produtos %>%
  group_by(StoreID) %>%
  slice_max(order_by = receita_total, n = 3)

top3_final <- top3_produtos_por_loja %>%
  left_join(lojas, by = "StoreID") %>%
  select(
    Loja = NameStore,
    Produto = NameProduct,
    Quantidade_Vendida = quantidade_vendida,
    Receita_Total = receita_total
  ) %>%
  arrange(Loja, desc(Receita_Total))

view(top3_final)

grafico_top3 <- ggplot(top3_final, aes(
  x = reorder(Produto, Receita_Total),
  y = Receita_Total,
  fill = Loja
)) +
  geom_col(show.legend = TRUE) +
  coord_flip() +
  labs(
    title = "Top 3 produtos nas 3 lojas com maior receita em 1889",
    x = "Produto",
    y = "Receita Total (R$)"
  ) +
  scale_fill_manual(values = c("#A11D21", "#D96B50", "#F0B7A4")) +
  theme_minimal(base_size = 12) +
  theme(
    plot.title = element_text(face = "bold", hjust = 0.5),
    axis.title = element_text(face = "bold")
  )

grafico_top3

# Introdução
O relatório foi desenvolvido pela Empresa Júnior de Estatística da Universidade de Brasília (ESTAT) a partir da solicitação de João Sábio, proprietário da Old Town Road Ltda, uma holding que atua no setor comercial do faroeste. O objetivo central deste projeto é fornecer análises estatísticas descritivas que auxiliem o cliente na compreensão do mercado em uma determinada região de interesse para novos investimentos.
As análises foram elaboradas com base em um banco de dados fornecido pela empresa, contendo informações de clientes, lojas, produtos, vendas, cidades e funcionários. Entre as principais variáveis presentes estão: identificação das lojas e cidades, receitas anuais, peso e altura dos clientes, idade, sexo, além de dados sobre produtos e quantidades vendidas.
Todo o processamento e análise dos dados foram realizados utilizando o software R, com o apoio dos pacotes do tidyverse, e a visualização interativa foi construída no Power BI, de modo a facilitar a exploração dos resultados e permitir uma interpretação mais dinâmica das informações.
As seções seguintes deste relatório apresentam as análises solicitadas pelo cliente, abrangendo desde a receita média das lojas entre 1880 e 1889, até o perfil de clientes e produtos mais vendidos, de forma a oferecer uma visão ampla e estratégica sobre o desempenho comercial e o comportamento dos consumidores da região.

# Referencial Teórico

A elaboração deste relatório fundamenta-se em princípios da Análise Estatística Descritiva, área da Estatística responsável por resumir, organizar e interpretar conjuntos de dados por meio de medidas numéricas, tabelas e representações gráficas. Esse tipo de abordagem permite compreender padrões, tendências e características gerais de uma população ou amostra, sem recorrer a inferências ou testes de hipóteses.
Entre as principais ferramentas utilizadas na análise descritiva estão as medidas de tendência central, como média, mediana e moda , que resumem o comportamento típico dos dados, e as medidas de dispersão, como variância, desvio-padrão e amplitude , que indicam o grau de variabilidade presente nas observações. Além disso, foram utilizadas técnicas gráficas (como histogramas, boxplots e gráficos de barras) que possibilitam uma visualização intuitiva e comparativa dos resultados obtidos.
As análises também consideraram relações entre variáveis numéricas, por meio de representações gráficas de dispersão, permitindo observar a possível existência de padrões de associação entre elas, como no caso da análise de peso e altura dos clientes.
Para a execução das análises, foi utilizado o software R, amplamente empregado em pesquisas estatísticas e científicas, especialmente em conjunto com o pacote tidyverse, que oferece um ecossistema integrado para manipulação, limpeza e visualização de dados. A etapa de visualização interativa foi desenvolvida no Power BI, ferramenta que possibilita a construção de dashboards dinâmicos, permitindo ao cliente explorar diferentes filtros, períodos e categorias de forma acessível e visualmente informativa.
Dessa forma, o referencial teórico que embasa este relatório apoia-se na estatística descritiva como instrumento para compreender e sintetizar informações de forma clara, contribuindo para a tomada de decisões estratégicas pela Old Town Road Ltda. a partir de uma leitura objetiva e visualmente rica dos dados.

# Análises

## Análise 1
O objetivo dessa análise é avaliar a evolução da receita média das lojas da empresa Old Town Road ao longo do período de 1880 a 1889.
A variável ano é quantitativa discreta, pois representa períodos temporais definidos, enquanto receita média (R$) é uma variável quantitativa contínua, expressando valores monetários.
Esta é uma análise descritiva temporal, que busca observar tendências, variações e possíveis padrões de crescimento nas receitas ao longo do tempo.

```{r}
#| label: fig-histograma
#| fig-cap: "Gráfico de linhas da Receita Média da loja dos anos 1880 até 1889"
histograma
```

Com base no gráfico $\ref{fig-histograma}$ de linhas apresentado, analisa-se uma mudança significativa na receita média das lojas.
Entre 1880 e 1884, observa-se um crescimento moderado, com pequenas oscilações que sugerem  estabilidade nas vendas. A partir de 1885, há um aumento mais acentuado, indicando um período de expansão comercial ou aumento no volume de vendas.
O destaque está em 1889, onde ocorre um salto expressivo na receita média, possivelmente relacionado a eventos econômicos, abertura de novas lojas ou estratégias de mercado bem-sucedidas.
Apesar de pequenas variações anuais, a tendência geral é positiva, refletindo crescimento sustentado ao longo da década de 1880.

## Análise 2
O objetivo desta análise é compreender a relação entre o **peso (kg)** e a **altura (cm)** dos clientes da empresa **Old Town Road Ltda.**
As variáveis analisadas são **quantitativas contínuas**, representando medidas físicas obtidas individualmente para cada cliente.
Trata-se de uma **análise descritiva bivariada**, cujo intuito é identificar padrões de associação e tendências de crescimento conjunto entre essas duas medidas corporais.
O conjunto de dados contém `r n_clientes` observações únicas, sem duplicações.
Antes da análise, as medidas foram convertidas para o **Sistema Internacional** (peso em quilogramas e altura em centímetros).

```{r}
#| label: dispersao
#| fig-cap: "Gráfico de linhas da Receita Média da loja dos anos 1880 até 1889"
dispersao
```

Conforme observado na Figura $\ref{fig-dispersao}$, os pontos seguem um padrão ascendente, sugerindo uma relação linear positiva entre peso e altura.
À medida que a altura aumenta, o peso tende a crescer, refletindo a proporcionalidade esperada entre estatura e massa corporal.
O coeficiente de correlação de Pearson, calculado como r = 0,6971007 correlacao_formatado, confirma essa relação com uma associação positiva moderada a forte.
Isso indica que clientes mais altos tendem, em média, a apresentar maior peso corporal — comportamento coerente com padrões biológicos e antropométricos.
Embora existam variações individuais, possivelmente associadas a diferenças de constituição física, idade ou estilo de vida, o comportamento global aponta para uma relação consistente entre as variáveis analisadas.

## Análise 3
Com o intuito de compreender melhor o perfil etário dos clientes nas diferentes lojas da cidade de Âmbar Seco, optou-se pela utilização do gráfico boxplot (ou diagrama de caixa). Esse tipo de visualização é especialmente adequado para comparar distribuições de uma variável quantitativa, neste caso, a idade dos clientes, entre categorias distintas, como as diversas lojas analisadas.
O boxplot permite observar, de forma sintética e objetiva, medidas de tendência central, dispersão e assimetria, além de identificar valores atípicos que podem indicar variações importantes no público atendido por cada loja.

```{r}
#| label: box
#| fig-cap: "Idade dos clientes de Âmbar Seco a depender da loja"
box
```

Com base no boxplot apresentado, a maior concentração de idades está entre 28 e 44 anos, o intervalo que compreende 50% dos clientes. A mediana (36 anos) e a média (37,48) são muito próximas — indicando simetria na distribuição (não há forte viés para jovens nem para idosos). Os outliers estão acima dos 60–65 anos, chegando até 80 anos.Isso mostra que, embora o público predominante seja adulto jovem e de meia-idade, há clientes mais idosos, possivelmente fiéis ou tradicionais na cidade.

## Análise 4
O objetivo desta análise é identificar os três produtos mais vendidos nas três lojas com maior receita no ano de 1889, permitindo compreender quais itens impulsionaram o faturamento no período e quais estabelecimentos se destacaram em volume e desempenho de vendas.
As variáveis envolvidas são:
* Loja (qualitativa nominal) — representa cada estabelecimento;
* Produto (qualitativa nominal) — identifica o item comercializado;
* Quantidade vendida e receita total (quantitativas contínuas) — medem o desempenho das vendas.
Essa é uma análise descritiva multivariada, voltada à avaliação do desempenho conjunto entre produtos e lojas, destacando a importância relativa de cada item dentro das unidades de maior faturamento no ano.

```{r}
#| label: top3_produtos
#| fig-cap: "Top 3 produtos nas 3 lojas com maior receita em 1889"
grafico_top3
```
#Conclusões

As análises conduzidas neste documento forneceram uma visão abrangente sobre o desempenho das lojas e o perfil dos clientes da Old Town Road Ltda., permitindo traduzir os dados disponíveis em informações estratégicas de valor para a tomada de decisão.
O estudo da receita média entre 1880 e 1889 evidenciou um cenário de crescimento sustentado ao longo da década, refletindo um período de expansão econômica e amadurecimento operacional das lojas. Esse comportamento indica que a empresa consolidou sua presença no mercado e obteve ganhos consistentes em produtividade e volume de vendas.
A análise bivariada entre peso e altura dos clientes demonstrou coerência e consistência nos dados coletados, com uma correlação positiva significativa. Tal resultado reforça a confiabilidade do banco de dados e mostra que as informações são adequadas para estudos futuros sobre perfil físico, comportamento do consumidor e segmentação de público.
A análise etária dos clientes de Âmbar Seco revelou um público predominantemente composto por adultos jovens e de meia-idade, com uma distribuição equilibrada e presença de consumidores mais experientes, o que pode indicar fidelização de longo prazo e potencial para ações de marketing segmentadas por faixa etária.
De modo geral, o projeto demonstra a importância da Estatística Descritiva como ferramenta de diagnóstico e suporte gerencial, fornecendo evidências objetivas que auxiliam o cliente na compreensão do cenário comercial e de consumo. A partir deste diagnóstico, a empresa tem subsídios concretos para aprimorar processos internos, planejar expansões e otimizar o desempenho operacional de suas unidades, consolidando-se de forma ainda mais sólida no mercado.

